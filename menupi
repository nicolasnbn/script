#!/bin/bash

CAPTURE_DIR="/home/pi/pineapple/captures"
CREDS_FILE="$CAPTURE_DIR/creds.txt"

echo "===== WiFi Pineapple CLI Controller ====="
echo "D√©marr√© le : $(date)"
echo "-----------------------------------------"

while true; do
    echo
    echo "Que souhaites-tu faire ?"
    echo "  1) ‚ñ∂Ô∏è  D√©marrer le Pineapple"
    echo "  2) ‚èπÔ∏è  Arr√™ter le Pineapple"
    echo "  3) üß™ Voir les 10 derniers paquets r√©seau (tcpdump)"
    echo "  4) üîê Voir les identifiants captur√©s"
    echo "  5) ‚ùå Quitter"
    echo "-----------------------------------------"
    read -p "Choix (1-5) : " choice
    echo

    case $choice in
        1)
            echo "üëâ D√©marrage du WiFi Pineapple..."
            if sudo /home/pi/start_pineapple.sh; then
                echo "‚úÖ Pineapple d√©marr√© avec succ√®s."
            else
                echo "‚ùå Une erreur s'est produite lors du d√©marrage."
            fi
            echo "-----------------------------------------"
            ;;
        2)
            echo "üëâ Arr√™t du WiFi Pineapple..."
            if sudo /home/pi/stop_pineapple.sh; then
                echo "‚úÖ Pineapple arr√™t√© proprement."
            else
                echo "‚ùå Erreur lors de l'arr√™t."
            fi
            echo "-----------------------------------------"
            ;;
        3)
            echo "üëâ Lecture des derniers paquets captur√©s..."
            last_pcap=$(ls -t "$CAPTURE_DIR"/*.pcap 2>/dev/null | head -n1)
            if [[ -f "$last_pcap" ]]; then
                sudo tcpdump -r "$last_pcap" -n -c 10
            else
                echo "‚ö†Ô∏è Aucun fichier de capture trouv√© dans $CAPTURE_DIR"
            fi
            echo "-----------------------------------------"
            ;;
        4)
            echo "üëâ Lecture des identifiants captur√©s..."
            if [[ -f "$CREDS_FILE" ]]; then
                cat "$CREDS_FILE"
            else
                echo "‚ö†Ô∏è Aucun identifiant captur√© pour le moment."
            fi
            echo "-----------------------------------------"
            ;;
        5)
            echo "üëã Quitte le menu. √Ä bient√¥t !"
            echo "-----------------------------------------"
            break
            ;;
        *)
            echo "‚ùå Choix invalide. Entrez un chiffre entre 1 et 5."
            echo "-----------------------------------------"
            ;;
    esac
done